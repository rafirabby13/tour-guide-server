enum TourStatus {
  BLOCKED
  DRAFT
  PUBLISHED
}

model Tour {
  id          String     @id @default(uuid())
  title       String     @db.VarChar(255)
  description String     @db.Text
  location    String     @db.VarChar(255)
  images      String[]
  status      TourStatus @default(DRAFT)
  // totalPriceCalculated       String?

  guideId String
  guide   Guide  @relation("GuideTours", fields: [guideId], references: [id], onDelete: Cascade)

  bookings           Booking[]
  reviews            Review[]
  blockedDates       BlockedDate[]
  tourAvailabilities TourAvailability[]
  tourPricings       TourPricing[]

  isDeleted Boolean  @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([guideId])
  @@index([status])
  @@index([isDeleted])
}

model TourPricing {
  id     String @id @default(uuid())
  tourId String
  tour   Tour   @relation(fields: [tourId], references: [id], onDelete: Cascade)

  minGuests    Int     @default(1)
  maxGuests    Int     @default(10)
  pricePerHour Decimal @db.Decimal(10, 2)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tourId, minGuests, maxGuests]) // Prevent duplicate tiers
  @@index([tourId])
}

model TourAvailability {
  id     String @id @default(uuid())
  tourId String
  tour   Tour   @relation(fields: [tourId], references: [id], onDelete: Cascade)

  dayOfWeek        Int // 0-6
  startTimeMinutes Int // 0-1439 (minutes since midnight)
  endTimeMinutes   Int // 0-1439
  maxBookings      Int     @default(1)
  isActive         Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tourId, dayOfWeek, startTimeMinutes, endTimeMinutes])
  @@index([tourId, dayOfWeek, isActive])
}

model BlockedDate {
  id String @id @default(uuid())

  tourId  String?
  tour    Tour?   @relation(fields: [tourId], references: [id], onDelete: Cascade)
  guideId String
  guide   Guide   @relation(fields: [guideId], references: [id], onDelete: Cascade)

  blockedDate DateTime
  // startTimeMinutes Int?   
  // endTimeMinutes   Int?
  // reason           String?  @db.VarChar(255)
  // isAllDay         Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([tourId, guideId, blockedDate])
  @@index([guideId, blockedDate])
  @@index([tourId, blockedDate])
}
